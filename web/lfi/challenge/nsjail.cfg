name: "php-web-challenge"
description: "Serve PHP app on port 1337"

mode: LISTEN
port: 1337

setuid: 1337
setgid: 1337

time_limit: 60
max_cpus: 1.0

# UID/GID mapping for user namespace
uidmap {
  inside_id: 1337
  outside_id: 1337
}
gidmap {
  inside_id: 1337
  outside_id: 1337
}

# Bind the challenge directory
mount {
  src: "/challenge"
  dst: "/challenge"
  is_bind: true
  rw: true
}

# Read-only system mounts
mount { src: "/usr"   dst: "/usr"   is_bind: true rw: false }
mount { src: "/lib"   dst: "/lib"   is_bind: true rw: false }
mount { src: "/lib64" dst: "/lib64" is_bind: true rw: false }
mount { src: "/bin"   dst: "/bin"   is_bind: true rw: false }
mount { src: "/sbin"  dst: "/sbin"  is_bind: true rw: false }

# tmpfs for /tmp
mount {
  dst: "/tmp"
  fstype: "tmpfs"
  rw: true
  options: "size=50000000"
}

# proc filesystem
mount { dst: "/proc" fstype: "proc" }

cwd: "/challenge"

# Launch PHP built-in server
exec_bin {
  path: "/usr/bin/php"
  arg0: "php"
  arg: "-S"
  arg: "0.0.0.0:1337"
  arg: "-t"
  arg: "/challenge"
}

# Resource limits
rlimit_cpu: 30
rlimit_fsize: 100
rlimit_nofile: 128
rlimit_nproc: 64
rlimit_stack: 8

# Namespaces
clone_newuser: true
clone_newns: true
clone_newpid: true
clone_newipc: true
clone_newuts: true

disable_no_new_privs: true

